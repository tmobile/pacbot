<!--
 *Copyright 2018 T Mobile, Inc. or its affiliates. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); You may not use
 * this file except in compliance with the License. A copy of the License is located at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * or in the "license" file accompanying this file. This file is distributed on
 * an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or
 * implied. See the License for the specific language governing permissions and
 * limitations under the License.
 -->

 <div class="compliance-dashboard-wrapper flex flex-between">
    <div class="floating-widgets-section-full flex flex-col">
        <app-breadcrumb [breadcrumbLinks]="breadcrumbDetails.breadcrumbLinks" [breadcrumbArray]="breadcrumbDetails.breadcrumbArray" [breadcrumbPresent]="breadcrumbDetails.breadcrumbPresent"></app-breadcrumb>
        <div class="floating-widgets-header flex flex-between">
            <div>
                <img *ngIf="backButtonRequired" class="arrow-img v-mid" (click)="navigateBack()" style="height: 1.4em;" src="../assets/icons/left-arrow.svg">
                <h1 class="title-text v-mid">{{pageTitle}} </h1>
                <span *ngIf="vulnerabilityTitle" title="(Title: {{vulnerabilityTitle}})" class="sub-text v-mid">(Title: {{vulnerabilityTitle}})</span>
            </div>
            <div class='flex relative z-index' *ngIf="isFilterRquiredOnPage">
                <app-generic-page-filter [filterId]="1" [filterArray]="filterArray" (onFilterValueChange)="updateUrlWithNewFilters($event)"></app-generic-page-filter>
            </div>
        </div>
        <div class='floating-widgets-filter-wrapper' *ngIf="isFilterRquiredOnPage">
            <app-filtered-selector (updateFilterArray)='updateUrlWithNewFilters($event)' [(filteredArray)]='filterArray'></app-filtered-selector>
        </div>
        <div class="floating-widgets-section-full scroll flex flex-col">
            <section>
                <ul>
                    <li class="widget-wrapper flex flex-col">
                        <div class="widget widget-container flex flex-col">
                            <div class="vul-details-wrapper flex flex-col" *ngIf="errorValue > 0">
                                <div class='tabs-container flex flex-row flex-align-center' *ngIf="selectedTab">
                                    <div (click)='selectedTab.name = tabs; getselectedTabData()' class='vul-details-tabs capitalize' *ngFor="let tabs of tabsName; let i = index " [class.loaded]='loaded' [class.active]='tabs == selectedTab.name'>{{tabs}}
                                    </div>
                                </div>
                                <div class="tabs-detail-wrapper flex flex-col">
                                    <div class="error-msg-block center list-details" *ngIf="errorValue == 2">
                                        <div class="error-handling">
                                            <p class="light-text">{{error_messages[selectedTab.name].description}}</p>
                                        </div>
                                    </div>
                                    <div class="flex flex-wrap" *ngIf="selectedTabData && (selectedTab.name.toLowerCase() == 'general info')">
                                        <div class="search">
                                            <article class="search-section flex">
                                                <img class="search-icon" src="../assets/icons/search.svg">
                                                <input #query type="text" [(ngModel)]='search' class="input-text" placeholder="Filter by Name">
                                            </article>
                                        </div>
                                        <ul class="container" *ngFor="let key of selectedTabData" [highlight]="search">
                                            <li class="list-details"><span class="details-list-key details-left-value">{{key}}</span>
                                                <span class="details-list-value flex flex-row flex-wrap highlight-link" [innerHTML]='selectedTab.attributes[key]'></span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="list-details details-text highlight-link" *ngIf="selectedTab && (selectedTab.name.toLowerCase() == 'threat' || selectedTab.name.toLowerCase() == 'solution')">
                                        <div [innerHTML]='selectedTab.attributes'></div>
                                    </div>
                                    <div class="list-details details-text highlight-link" *ngIf="selectedTab && (selectedTab.name.toLowerCase() == 'impact')">
                                        <div>{{selectedTab.attributes}}</div>
                                    </div>
                                    <div class="list-details" *ngIf="selectedTab && (selectedTab.name.toLowerCase() == 'software')">
                                        <table class="software-table" id='software-table'>
                                            <tbody [innerHTML]='selectedTab.attributes'></tbody>
                                        </table>
                                    </div>
                                    <div class="list-details scroll details-text" *ngIf="selectedTab && (selectedTab.name.toLowerCase() == 'exploitability')">
                                        <div class=" flex flex-col data-list" *ngFor="let value of selectedTabData">
                                            <div class="data-src">{{value.srcname}}</div>
                                            <div class="flex flex-row" *ngIf="value.exploits[0].ref">
                                                <div class="left-content">Reference:</div>
                                                <div class="flex flex-row flex-wrap data-value">
                                                    <div> {{value.exploits[0].ref}}</div>
                                                </div>
                                            </div>
                                            <div class="flex flex-row" *ngIf="value.exploits[0].desc">
                                                <div class="left-content">Description:</div>
                                                <div class="flex flex-row flex-wrap data-value">
                                                    <div> {{value.exploits[0].desc}}</div>
                                                </div>
                                            </div>
                                            <div class="flex flex-row" *ngIf="value.exploits[0].link">
                                                <div class="left-content">Link:</div>
                                                <div class="flex flex-row flex-wrap data-value highlight-link">
                                                    <div> <a target='_blank' class="link-text" href='{{value.exploits[0].link}}'>{{value.exploits[0].link}}</a></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="list-details scroll details-text" *ngIf="selectedTab && (selectedTab.name.toLowerCase() == 'malware')">
                                        <div class=" flex flex-col data-list" *ngFor="let value of selectedTabData">
                                            <div class="data-src">{{value.srcname}}</div>
                                            <div class="flex flex-col malware-list-details" *ngFor="let data of value.malwares">
                                                <div class="flex flex-row" *ngIf="data.mwid">
                                                    <div class="left-content">Id:</div>
                                                    <div class="flex flex-row flex-wrap data-value">
                                                        <div> {{data.mwid}}</div>
                                                    </div>
                                                </div>
                                                <div class="flex flex-row" *ngIf="data.mwtype">
                                                    <div class="left-content">Type:</div>
                                                    <div class="flex flex-row flex-wrap data-value">
                                                        <div> {{data.mwtype}}</div>
                                                    </div>
                                                </div>
                                                <div class="flex flex-row" *ngIf="data.mwplatform">
                                                    <div class="left-content">Platform:</div>
                                                    <div class="flex flex-row flex-wrap data-value">
                                                        <div> {{data.mwplatform}}</div>
                                                    </div>
                                                </div>
                                                <div class="flex flex-row" *ngIf="data.mwrating">
                                                    <div class="left-content">Rating:</div>
                                                    <div class="flex flex-row flex-wrap data-value">
                                                        <div> {{data.mwrating}}</div>
                                                    </div>
                                                </div>
                                                <div class="flex flex-row" *ngIf="data.mwlink">
                                                    <div class="left-content">Link:</div>
                                                    <div class="flex flex-row flex-wrap data-value highlight-link">
                                                        <div> <a target='_blank' class="link-text" href='{{data.mwlink}}'>{{data.mwlink}}</a></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class='loader' *ngIf='errorValue==0'></div>
                            <div class="error-msg-block center list-details" *ngIf="errorValue == -1">
                                <app-error-message [selectedValue]="errorMessage"></app-error-message>
                            </div>
                        </div>
                    </li>
                </ul>
            </section>
        </div>
    </div>
</div>